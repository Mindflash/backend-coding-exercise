digraph architecture {
    nsq [label="NSQ" style="filled" fillcolor="skyblue1"]
    brainspark [label="Brainspark API" shape="egg" style="filled" fillcolor="orange"]
    es [label="ElasticSearch" shape="egg" style="filled" fillcolor="lightseagreen"]
    

    brainspark->nsq [label="publish\nevents"]
    app->nsq [label="consume\nevents"]
    app->es [label="index\n events"]
    brainspark->es [label="search &\n   aggregate"]
    app->brainspark [label="query\n  related\ndata"]

    subgraph clusterApp {
        color="lightgrey"
        style="filled"
        app [label="Your App" shape="rect" style="filled" fillcolor="gold"]

        app->app [label="filter &\n   hydrate\n    events"]
    }
}